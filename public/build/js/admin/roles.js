import FetchDatos from"../classes/FetchDatos.js";import Formulario from"../classes/Formulario.js";import Modal from"../classes/Modal.js";import PostDatos from"../classes/PostData.js";import{limpiarHTML}from"../functions/funciones.js";(()=>{const e=document.querySelector("#table-roles tbody"),t=document.querySelector("#agregar-rol");let o=[],r={};function n(){limpiarHTML(e),o.forEach((t=>{const{id:i,name:s,description:l}=t,c=document.createElement("TR");c.className="whitespace-nowrap bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600";const d=document.createElement("TD");d.className="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",d.textContent=i;const m=document.createElement("TD");m.className="px-6 py-4",m.textContent=s;const p=document.createElement("TD");p.className="px-6 py-4",p.textContent=l;const u=document.createElement("TD");u.className="py-2 px-6 flex flex-row items-center gap-2";const x=document.createElement("BUTTON");x.className="flex items-center justify-center w-full uppercase text-xs py-1 px-3 rounded-md shadow-md bg-primary-base text-font-light hover:bg-primary-dark gap-2",x.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Editar</p>',x.onclick=()=>{r=t,a(!0)};const f=document.createElement("BUTTON");f.className="flex items-center justify-center w-full uppercase text-xs py-1 px-3 rounded-md shadow-md bg-red-600 text-font-light hover:bg-red-500 gap-2",f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Eliminar</p>',f.onclick=()=>{r=t,Swal.fire({title:`¿Estás seguro de eliminar el rol "${r.name}"?`,text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&async function(){const e="/api/rol-eliminar",t=await PostDatos.eliminarDatos(e,r.id);"Exito"===t.tipo&&(Swal.fire({title:t.tipo,text:t.mensaje,icon:"success"}),o=o.filter((e=>e.id!==r.id)),n())}()}))},u.appendChild(x),u.appendChild(f),c.appendChild(d),c.appendChild(m),c.appendChild(p),c.appendChild(u),e.appendChild(c)}))}function a(e=!1){const t=document.createElement("FORM");t.className="space-y-5 mb-5";const a=document.createElement("H3");a.className="text-lg font-medium text-gray-900 dark:text-white",a.textContent="Ingrese los datos solicitados";const i=document.createElement("DIV");i.id="div-notif",t.appendChild(a),t.appendChild(i),Formulario.crearInput(t,"Ingrese el rol","text","name",e?r.name:null),Formulario.crearTextarea(t,"Descripción","description",e?r.description:null),e&&Formulario.crearInput(t,"id","hidden","id",r.id);const s=document.createElement("BUTTON");s.className="text-white bg-orange-500 hover:bg-orange-900 font-medium rounded text-sm inline-flex items-center px-5 py-2 text-center",s.textContent="Guardar",s.onclick=t=>{!1===e?async function(e){const t=e.target.parentElement.parentElement.querySelector("form"),r=t.querySelectorAll(".input-form"),a="/api/rol",i=await PostDatos.guardarDatos(a,r);if("Exito"===i.tipo){const e=document.querySelector(".default-modal");e&&e.remove(),Swal.fire({title:i.tipo,text:i.mensaje,icon:"success"});const t={id:i.rol.id,name:i.rol.name,description:i.rol.description};o=[...o,t],n()}else Swal.fire({title:i.tipo,text:i.mensaje,icon:"error"})}(t):async function(e){const t=e.target.parentElement.parentElement.querySelector("form"),a=t.querySelectorAll(".input-form"),i="/api/rol-actualizar",s=await PostDatos.guardarDatos(i,a);if("Exito"===s.tipo){const e=document.querySelector(".default-modal");e&&e.remove(),Swal.fire({title:s.tipo,text:s.mensaje,icon:"success"}),o=o.map((e=>(e.id===r.id&&(e.name=s.rol.name,e.description=s.rol.description),e))),n()}else Swal.fire({title:"error",text:"Hubo un error al actualizar este rol",icon:"error"})}(t)},Modal.renderModal(t,s)}document.addEventListener("DOMContentLoaded",(()=>{!async function(){o=await FetchDatos.consultar("/api/roles"),n()}(),t.addEventListener("click",(()=>{r={},a(!1)}))}))})();