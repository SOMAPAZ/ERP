import Formulario from"../classes/Formulario.js";import Modal from"../classes/Modal.js";import PostDatos from"../classes/PostData.js";import GetDatos from"../classes/GetData.js";import{limpiarHTML}from"../helpers/index.js";(()=>{const e=document.querySelector("#table-employees tbody"),t=document.querySelector("#agregar-empleado");let o=[],a={},r=[];function n(){limpiarHTML(e),o.forEach((t=>{const{id:r,nombre:s,apellido:i,correo:c,telefono:m,rol:d}=t,p=document.createElement("TR");p.className="whitespace-nowrap bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600";const u=document.createElement("TD");u.className="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",u.textContent=r;const x=document.createElement("TD");x.className="px-6 py-4",x.textContent=`${s} ${i}`;const f=document.createElement("TD");f.className="px-6 py-4",f.textContent=c;const g=document.createElement("TD");g.className="px-6 py-4",g.textContent=m;const h=document.createElement("TD");h.className="px-6 py-4",h.textContent=d;const w=document.createElement("TD");w.className="py-2 px-6 flex flex-row items-center gap-2";const y=document.createElement("BUTTON");y.className="flex items-center justify-center w-full uppercase text-xs py-1 px-3 rounded-md shadow-md bg-primary-base text-font-light hover:bg-primary-dark gap-2",y.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Editar</p>',y.onclick=()=>{a=t,l(!0)};const E=document.createElement("BUTTON");E.className="flex items-center justify-center w-full uppercase text-xs py-1 px-3 rounded-md shadow-md bg-red-600 text-font-light hover:bg-red-500 gap-2",E.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Eliminar</p>',E.onclick=()=>{a=t,Swal.fire({title:`¿Estás seguro de eliminar a ${a.nombre} ${a.apellido}?`,text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&async function(){const e="/api/empleado-eliminar",t=await PostDatos.eliminarDatos(e,a.id);"Exito"===t.tipo&&(Swal.fire({title:t.tipo,text:t.mensaje,icon:"success"}),o=o.filter((e=>e.id!==a.id)),n())}()}))},w.appendChild(y),w.appendChild(E),p.appendChild(u),p.appendChild(x),p.appendChild(f),p.appendChild(g),p.appendChild(h),p.appendChild(w),e.appendChild(p)}))}function l(e=!1){const t=document.createElement("FORM");t.autocomplete="off",t.className="space-y-5 mb-5";const l=document.createElement("H3");l.className="text-lg font-medium text-gray-900 dark:text-white",l.textContent="Ingrese los datos solicitados";const s=document.createElement("DIV");s.id="div-notif",t.appendChild(l),t.appendChild(s),Formulario.crearInput(t,"Ingrese el nombre","text","name",e?a.nombre:null),Formulario.crearInput(t,"Ingrese el apellido","text","lastname",e?a.apellido:null),Formulario.crearInput(t,"Ingrese el email","email","mail",e?a.correo:null),Formulario.crearInput(t,"Ingrese el teléfono","tel","phone",e?a.telefono:null),e?Formulario.crearInput(t,"id","hidden","id",a.id):Formulario.crearInput(t,"Ingrese el password","password","password"),Formulario.crearSelect(t,"Seleccione un rol","id_rol",r,e?a.rol:null);const i=document.createElement("BUTTON");i.className="text-white bg-orange-500 hover:bg-orange-900 font-medium rounded text-sm inline-flex items-center px-5 py-2 text-center",i.textContent="Guardar",i.onclick=t=>{!1===e?async function(e){const t=e.target.parentElement.parentElement.querySelector("form"),a=t.querySelectorAll(".input-form"),r="/api/empleado",l=await PostDatos.guardarDatos(r,a);if("Exito"===l.tipo){const e=document.querySelector(".default-modal");e&&e.remove(),Swal.fire({title:l.tipo,text:l.mensaje,icon:"success"});const t={id:l.usuario.id,nombre:l.usuario.name,apellido:l.usuario.lastname,correo:l.usuario.mail,telefono:l.usuario.phone,rol:l.rol};o=[...o,t],n()}else Swal.fire({title:l.tipo,text:l.mensaje,icon:"error"})}(t):async function(e){const t=e.target.parentElement.parentElement.querySelector("form"),r=t.querySelectorAll(".input-form"),l="/api/empleado-actualizar",s=await PostDatos.guardarDatos(l,r);if("Exito"===s.tipo){const e=document.querySelector(".default-modal");e&&e.remove(),Swal.fire({title:s.tipo,text:s.mensaje,icon:"success"}),o=o.map((e=>(e.id===a.id&&(e.nombre=s.usuario.name,e.apellido=s.usuario.lastname,e.correo=s.usuario.mail,e.telefono=s.usuario.phone,e.rol=s.rol),e))),n()}else Swal.fire({title:"error",text:"Hubo un error al actualizar el empleado",icon:"error"})}(t)},Modal.renderModal(t,i)}document.addEventListener("DOMContentLoaded",(()=>{!async function(){o=await GetDatos.consultar("/api/empleados"),n()}(),async function(){r=await GetDatos.consultar("/api/roles")}(),t.addEventListener("click",(()=>{a={},l(!1)}))}))})();