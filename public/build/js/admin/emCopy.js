import Notificacion from"../classes/Notificacion.js";import FetchDatos from"../classes/FetchDatos.js";import{limpiarHTML}from"../functions/funciones.js";(()=>{const e=document.querySelector("#table-employees tbody"),t=document.querySelector("#agregar-empleado");let o=[],n=[];function a(){limpiarHTML(e),o.forEach((t=>{const{id:n,nombre:l,apellido:c,correo:d,telefono:i,rol:s}=t,m=document.createElement("TR");m.className="whitespace-nowrap bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600";const p=document.createElement("TD");p.className="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",p.textContent=n;const u=document.createElement("TD");u.className="px-6 py-4",u.textContent=`${l} ${c}`;const f=document.createElement("TD");f.className="px-6 py-4",f.textContent=d;const g=document.createElement("TD");g.className="px-6 py-4",g.textContent=i;const x=document.createElement("TD");x.className="px-6 py-4",x.textContent=s;const h=document.createElement("TD");h.className="py-2 px-6 flex flex-row items-center gap-2";const b=document.createElement("BUTTON");b.className="flex items-center justify-center w-full uppercase text-xs py-1 px-3 rounded-md shadow-md bg-primary-base text-font-light hover:bg-primary-dark gap-2",b.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />\n            </svg>\n            <p class="font-bold text-xs">Editar</p>\n            ',b.onclick=()=>{r(t)};const y=document.createElement("BUTTON");y.className="flex items-center justify-center w-full uppercase text-xs py-1 px-3 rounded-md shadow-md bg-red-600 text-font-light hover:bg-red-500 gap-2",y.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n                    <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />\n            </svg>\n            <p class="font-bold text-xs">Eliminar</p>\n            ',y.onclick=()=>{!function(e){Swal.fire({title:`¿Estás seguro de eliminar a ${e.nombre} ${e.apellido}?`,text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&async function(e){const t=e.id,n=new FormData;n.append("id",t);try{const e=`${location.origin}/api/empleado-eliminar`,r=await fetch(e,{method:"POST",body:n}),l=await r.json();if("Exito"===l.tipo){Swal.fire({title:l.tipo,text:l.mensaje,icon:"success"});const e=document.querySelector(".modal-form");e&&e.remove(),o=o.filter((e=>e.id!==t)),a()}}catch(e){console.log(e)}}(e)}))}(t)},h.appendChild(b),h.appendChild(y),m.appendChild(p),m.appendChild(u),m.appendChild(f),m.appendChild(g),m.appendChild(x),m.appendChild(h),e.appendChild(m)}))}function r(e={},t=!1){const r=document.createElement("DIV");r.className="overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 bottom-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%)] max-h-full bg-gray-800 bg-opacity-50 dark:bg-opacity-80 modal-form";const c=document.createElement("DIV");c.className="relative p-4 w-full max-w-2xl mx-auto mt-20 max-h-full";const d=document.createElement("DIV");d.className="relative bg-white rounded-lg shadow dark:bg-gray-700";const i=document.createElement("DIV");i.className="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600";const s=document.createElement("H3");s.className="text-xl font-semibold text-gray-900 dark:text-white",s.textContent="Actualizar datos",i.appendChild(s);const m=document.createElement("DIV");m.classList.add("errorVacio");const p=document.createElement("DIV");p.className="p-4 md:p-5 space-y-4";const u=document.createElement("FORM");u.className="grid gap-6 mb-6 md:grid-cols-2 form-empleados",t?(l(u,"text","nombre"),l(u,"text","apellido"),l(u,"email","mail"),l(u,"tel","telefono"),l(u,"password","password")):(l(u,"text","nombre",e.nombre),l(u,"text","apellido",e.apellido),l(u,"email","mail",e.correo),l(u,"tel","telefono",e.telefono));const f=document.createElement("DIV"),g=document.createElement("LABEL");g.for="role",g.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white uppercase",g.textContent="Seleccione un rol";const x=document.createElement("SELECT");x.name="role",x.id="role",x.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500";const h=document.createElement("OPTION");h.value="",h.textContent="- Seleccione un rol -",h.selected=!0,x.appendChild(h),n.forEach((t=>{const o=document.createElement("OPTION");o.value=t.id,o.textContent=t.name,t.name===e.rol&&(o.selected=!0),x.appendChild(o)})),f.appendChild(g),f.appendChild(x),u.appendChild(f);const b=document.createElement("DIV");b.className="flex items-center justify-end gap-4 p-4 md:p-5 border-t border-gray-200 rounded-b dark:border-gray-600";const y=document.createElement("BUTTON");y.className="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",y.textContent=t?"Agregar":"Actualizar",y.onclick=()=>{t?async function(){const e=document.querySelector("#nombre").value.trim(),t=document.querySelector("#apellido").value.trim(),n=document.querySelector("#mail").value.trim(),r=document.querySelector("#telefono").value.trim(),l=document.querySelector("#password").value.trim(),c=document.querySelector("#role").value.trim();if(""===e||""===t||""===n||""===r||""===l||""===c)return void new Notificacion({msg:"Los campos no pueden estar vacíos",position:document.querySelector(".errorVacio")});const d=new FormData;d.append("name",e),d.append("lastname",t),d.append("mail",n),d.append("phone",r),d.append("password",l),d.append("id_rol",c);try{const l=`${location.origin}/api/empleado`,c=await fetch(l,{method:"POST",body:d}),i=await c.json();if(console.log(i),"Exito"===i.tipo){Swal.fire({title:i.tipo,text:i.mensaje,icon:"success"});const l=document.querySelector(".modal-form");l&&l.remove();const c={id:String(i.id),nombre:e,apellido:t,correo:n,telefono:r,rol:i.rol};o=[...o,c],a()}else Swal.fire({title:i.tipo,text:i.mensaje,icon:"error"})}catch(e){console.log(e)}}():async function(e){const t=document.querySelector("#nombre").value.trim(),n=document.querySelector("#apellido").value.trim(),r=document.querySelector("#mail").value.trim(),l=document.querySelector("#telefono").value.trim(),c=document.querySelector("#role").value;if(""===t||""===n||""===r||""===l||""===c)return void new Notificacion({msg:"Los campos no pueden estar vacíos",position:document.querySelector(".errorVacio")});const d=new FormData;d.append("id",e.id),d.append("name",t),d.append("lastname",n),d.append("mail",r),d.append("phone",l),d.append("id_rol",c);try{const c=`${location.origin}/api/empleado-actualizar`,i=await fetch(c,{method:"POST",body:d}),s=await i.json();if("Exito"===s.tipo){Swal.fire({title:s.tipo,text:s.mensaje,icon:"success"});const c=document.querySelector(".modal-form");c&&c.remove(),o=o.map((o=>(o.id===e.id&&(o.nombre=t,o.apellido=n,o.correo=r,o.telefono=l,o.rol=s.rol),o))),a()}else Swal.fire({title:"error",text:"Hubo un error al actualizar el empleado",icon:"error"})}catch(e){console.log(e)}}(e)};const w=document.createElement("BUTTON");w.className="text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800",w.textContent="Cancelar",w.onclick=()=>document.querySelector(".modal-form")?.remove(),p.appendChild(u),b.appendChild(w),b.appendChild(y),d.appendChild(i),d.appendChild(m),d.appendChild(p),d.appendChild(b),c.appendChild(d),r.appendChild(c),document.querySelector("main").appendChild(r)}function l(e,t,o,n=""){const a=document.createElement("DIV"),r=document.createElement("LABEL");r.for=o,r.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white uppercase",r.textContent=o;const l=document.createElement("INPUT");l.type=t,l.name=o,l.id=o,l.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white",""===n?l.placeholder=`Tu ${o}`:l.value=n,a.appendChild(r),a.appendChild(l),e.appendChild(a)}document.addEventListener("DOMContentLoaded",(()=>{!async function(){o=await FetchDatos.consultar(`${location.origin}/api/empleados`),a()}(),async function(){n=await FetchDatos.consultar(`${location.origin}/api/roles`)}(),t.addEventListener("click",(()=>{r({},!0)}))}))})();