import Alerta from"../classes/Alerta_v1.js";import GetDatos from"../classes/GetData_v1.js";import PostDatos from"../classes/PostData_v1.js";import{getLocalStorage,limpiarHTML,saveLocalStorage}from"../helpers/index_v1.js";(()=>{const e=document.querySelector("#select-input"),t=document.querySelector("#contenedor-texto"),a=document.querySelector("#contenedor-folio"),o=document.querySelector("#contenedor-categoria"),n=document.querySelector("#data-category"),s=document.querySelector("#data-incidence"),i=document.querySelector("#filtrado-reporte"),r=document.querySelector("#div-notif"),d=document.querySelector("#resultados");let c="1",l="";document.addEventListener("DOMContentLoaded",(()=>{m(),n.addEventListener("change",p),l=getLocalStorage("conceptoBusqueda")??"",""!==l&&h(),e.addEventListener("change",u),i.addEventListener("submit",g)}));const m=async()=>{(await GetDatos.consultar(`${location.origin}/api/categorias`)).forEach((e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,n.appendChild(t)}))},p=async e=>{const t=e.target.value;if(""===t)return s.setAttribute("disabled","disabled"),s.value="",void limpiarHTML(s);const a=await PostDatos.enviarArray(`${location.origin}/api/incidencias`,t);"exito"===a.tipo&&a.datos.length>0&&(s.removeAttribute("disabled"),limpiarHTML(s),a.datos.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,s.appendChild(t)})))},u=e=>{c=e.target.value,i.reset(),"1"===c&&(t.classList?.remove("hidden"),!a.classList.contains("hidden")&&a.classList.add("hidden"),!o.classList.add("hidden")&&o.classList.add("hidden")),"2"===c&&(a.classList?.remove("hidden"),!t.classList.contains("hidden")&&t.classList.add("hidden"),!o.classList.contains("hidden")&&o.classList.add("hidden")),"3"===c&&(o.classList?.remove("hidden"),!a.classList.contains("hidden")&&a.classList.add("hidden"),!t.classList.contains("hidden")&&t.classList.add("hidden"))},g=e=>{e.preventDefault(),l="";const o=/^\d{4}-\d{4}$/;if("1"===c){if(l=t.querySelector("input").value.trim(),""===l)return void new Alerta({msg:"El campo es obligatorio",position:r});if(l.length<4)return void new Alerta({msg:"Valor demasiado corto",position:r});if(o.test(l))return void new Alerta({msg:"Este valor no es válido en este campo",position:r});h()}if("2"===c){if(l=a.querySelector("input").value.trim(),""===l)return void new Alerta({msg:"El campo es obligatorio",position:r});if(!o.test(l))return void new Alerta({msg:"El formato de folio es incorrecto, ej. 2502-0106",position:r});h()}if("3"===c){if(""===n.value||""===s.value)return void new Alerta({msg:"Ambos campos son obligatorios",position:r});l=[n.value,s.value],h()}},h=async()=>{saveLocalStorage("conceptoBusqueda",l);const e=await PostDatos.enviarArray(`${location.origin}/filtrar-reportes-coincidencias`,l);0!==e.length?(limpiarHTML(d),e.forEach((e=>{const t=document.createElement("DIV");t.className="bg-white dark:bg-gray-800 shadow rounded p-4 mb-4 uppercase text-left w-full space-y-2";const a=document.createElement("H2");a.className="text-xl font-bold dark:text-white",a.innerHTML=`Usuario: <span class="font-normal text-gray-700 dark:text-gray-300">${e.name||"Sin nombre"}</span>`,t.appendChild(a);const o=document.createElement("P");o.className="text-sm text-gray-700 dark:text-gray-300",o.innerHTML=`<span class="font-bold">Descripción:</span> ${e.description}`,t.appendChild(o);const n=document.createElement("P");n.className="text-sm text-gray-700 dark:text-gray-300",n.innerHTML=`<span class="font-bold">Folio:</span> ${e.id}`,t.appendChild(n);const s=document.createElement("P");s.className="text-sm text-gray-700 dark:text-gray-300",s.innerHTML=`<span class="font-bold">Fecha:</span> ${e.created}`,t.appendChild(s);const i=document.createElement("P");i.className="text-sm text-gray-700 dark:text-gray-300",i.innerHTML=`<span class="font-bold">Dirección:</span> ${e.address}`,t.appendChild(i);const r=document.createElement("P");r.className="text-sm text-gray-700 dark:text-gray-300",r.innerHTML=`<span class="font-bold">Teléfono:</span> ${e.phone}`,t.appendChild(r);const c=document.createElement("A");c.className="bg-indigo-600 hover:bg-indigo-700 text-xs font-bold p-2 text-white rounded",c.innerHTML=`<a href="${location.origin}/reporte?folio=${e.id}">Acceder al reporte</a>`;const l=document.createElement("DIV");l.className="flex justify-center",t.appendChild(l),l.appendChild(c),d.appendChild(t)}))):Alerta.Toast.fire({icon:"warning",title:"Upss!",text:"No se encontraron resultados"})}})();