(()=>{const e=document.querySelector("#render-notas"),t=document.querySelector("#btn-add-note");let n=[];function a(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).folio}async function o(e){const t=e.target.parentElement.parentElement,o=t.querySelector("#nota").value.trim(),d=t.querySelector("#evidencia").files[0];if(""===o&&void 0===d)return void function(e){const t=document.createElement("DIV");t.className="rounded border-s-4 mt-6 border-red-500 bg-red-50 p-4 dark:border-red-600 dark:bg-red-900 alerta",t.innerHTML=`<strong class="block font-medium text-red-700 dark:text-red-200">${e}</strong>`,document.querySelector(".alerta")?.remove();const n=document.querySelector("#formulario-add-informacion");n.parentElement.insertBefore(t,n),setTimeout((()=>{t.remove()}),5e3)}("No puedes dejar ambos campos en blanco");const c=new FormData;c.append("id_report",a()),c.append("note",o),c.append("image",d);try{const e=`${location.origin}/api/nota-reporte`,t=await fetch(e,{method:"POST",body:c}),a=await t.json();if("Exito"===a.tipo){Swal.fire({title:a.tipo,text:a.mensaje,icon:"success"});const e=document.querySelector(".modal-form");e&&e.remove();const t={id:a.id,created:a.created,note:o,image:a.imagen};n=[...n,t],r()}}catch(e){console.log(e)}}function r(){let t=1;!function(){for(;e.firstChild;)e.removeChild(e.firstChild)}(),0!==n.length?n.forEach((a=>{const{note:o,image:d,created:c}=a,l=document.createElement("DIV");l.className="items-center bg-gray-50 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700";const i=document.createElement("DIV");if(i.className="px-3",""===d)i.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-32 mx-auto md:mx-0"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>\n            ';else{const e=document.createElement("IMG");e.src=`images/${d}`,e.alt="Nota-imagen",e.className="w-full max-w-32 aspect-square rounded-lg mx-auto mt-3",i.appendChild(e)}l.appendChild(i);const s=document.createElement("DIV");s.className="p-3";const m=document.createElement("H3");m.className="text-lg font-bold tracking-tight text-gray-900 dark:text-white",m.textContent="Nota "+t++;const u=document.createElement("SPAN");u.className="text-base text-gray-500 dark:text-gray-400",u.textContent=c;const p=document.createElement("P");p.className="mt-3 mb-4 font-light text-base text-gray-500 dark:text-gray-400",p.textContent=""===o?"No se registró texto de nota":o;const g=document.createElement("BUTTON");g.className="flex mx-auto md:mx-0 items-center justify-center uppercase bg-red-600 text-font-light text-xs py-1 px-3 rounded-md shadow-md hover:bg-red-500 gap-2",g.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>\n        <p class="font-bold text-xs">Eliminar</p>\n      ',g.onclick=()=>{!function(e){Swal.fire({title:"¿Estás seguro de eliminar la nota?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&async function(e){const t=new FormData;t.append("id",e.id);try{const e=`${location.origin}/api/nota-reporte/eliminar`,a=await fetch(e,{method:"POST",body:t}),o=await a.json();"Exito"===o.tipo&&(Swal.fire({title:o.tipo,text:o.mensaje,icon:"success"}),n=[...n].filter((e=>e.id!==o.id)),r())}catch(e){console.log(e)}}(e)}))}(a)},s.appendChild(m),s.appendChild(u),s.appendChild(p),s.appendChild(g),l.appendChild(s),e.appendChild(l)})):e.innerHTML='<p class="text-center text-gray-500 dark:text-gray-400 col-span-2">No hay notas registradas</p>'}document.addEventListener("DOMContentLoaded",(()=>{!async function(){const e=new FormData;e.append("id_report",a());try{const t=`${location.origin}/api/notas-reportes`,a=await fetch(t,{method:"POST",body:e}),o=await a.json();n=o,console.log(n),r()}catch(e){console.log(e)}}(),t.addEventListener("click",(()=>{!function(){const e=document.createElement("DIV");e.className="overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 bottom-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%)] max-h-full bg-gray-800 bg-opacity-50 dark:bg-opacity-80 modal-form";const t=document.createElement("DIV");t.className="relative p-4 w-full max-w-2xl mx-auto mt-20 max-h-full";const n=document.createElement("DIV");n.className="relative bg-white rounded-lg shadow dark:bg-gray-700";const a=document.createElement("DIV");a.className="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600";const r=document.createElement("H3");r.className="text-xl font-semibold text-gray-900 dark:text-white",r.textContent="Añadir información",a.appendChild(r);const d=document.createElement("DIV");d.className="p-4 md:p-5 space-y-4";const c=document.createElement("FORM");c.id="formulario-add-informacion",c.setAttribute("autocomplete","off"),c.setAttribute("enctype","multipart/form-data");const l=document.createElement("DIV");l.className="flex flex-col gap-6";const i=document.createElement("DIV"),s=document.createElement("LABEL");s.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white",s.textContent="Agregue una nota";const m=document.createElement("TEXTAREA");m.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase",m.name="nota",m.id="nota",m.placeholder="Nota del Reporte",i.appendChild(s),i.appendChild(m);const u=document.createElement("DIV"),p=document.createElement("LABEL");p.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white",p.textContent="Tu evidencia",p.for="evidencia";const g=document.createElement("INPUT");g.className="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 file:bg-gray-200 file:text-gray-600 dark:file:bg-gray-900 dark:file:text-white file:border-0 file:p-2.5 file:cursor-pointer",g.id="evidencia",g.type="file",g.name="evidencia",g.accept=".jpg,.png,.jpeg",u.appendChild(p),u.appendChild(g),l.appendChild(i),l.appendChild(u),c.appendChild(l);const f=document.createElement("DIV");f.className="flex items-center justify-end gap-4 p-4 md:p-5 border-t border-gray-200 rounded-b dark:border-gray-600";const x=document.createElement("BUTTON");x.className="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",x.textContent="Agregar",x.onclick=o;const h=document.createElement("BUTTON");h.className="text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800",h.textContent="Cancelar",h.onclick=()=>document.querySelector(".modal-form")?.remove(),d.appendChild(c),f.appendChild(h),f.appendChild(x),n.appendChild(a),n.appendChild(d),n.appendChild(f),t.appendChild(n),e.appendChild(t),document.querySelector("main").appendChild(e)}()}))}))})();