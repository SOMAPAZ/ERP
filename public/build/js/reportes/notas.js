import GetDatos from"../classes/GetData.js";import Modal from"../classes/Modal.js";import PostDatos from"../classes/PostData.js";import Alerta from"../classes/Alerta.js";import{getSearch,limpiarHTML}from"../helpers/index.js";(()=>{const e=document.querySelector("#render-notas"),t=document.querySelector("#btn-add-note");let a=[];document.addEventListener("DOMContentLoaded",(()=>{o(),t.addEventListener("click",(()=>n()))}));const o=async()=>{const e=`${location.origin}/api/notas-reportes?id_report=${getSearch().folio}`;a=await GetDatos.consultar(e),l()},n=()=>{const e=document.createElement("DIV");e.className="p-4 space-y-4 mb-4";const t=document.createElement("FORM");t.id="formulario-add-nota",t.setAttribute("autocomplete","off"),t.setAttribute("enctype","multipart/form-data");const a=document.createElement("DIV");a.className="flex flex-col gap-6";const o=document.createElement("H3");o.className="text-lg font-medium text-gray-900 dark:text-white mb-5",o.textContent="Ingrese los datos solicitados";const n=document.createElement("DIV");n.id="div-notif",t.appendChild(o),t.appendChild(n);const l=document.createElement("DIV"),s=document.createElement("LABEL");s.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white",s.textContent="Agregue una nota";const d=document.createElement("TEXTAREA");d.className="inputs-form bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase",d.name="note",d.id="nota",d.placeholder="Nota del Reporte",l.appendChild(s),l.appendChild(d);const c=document.createElement("DIV"),i=document.createElement("LABEL");i.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white",i.textContent="Tu evidencia",i.for="image";const m=document.createElement("INPUT");m.className="inputs-form block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 file:bg-gray-200 file:text-gray-600 dark:file:bg-gray-900 dark:file:text-white file:border-0 file:p-2.5 file:cursor-pointer",m.id="image",m.type="file",m.name="image",m.accept=".jpg,.png,.jpeg",c.appendChild(i),c.appendChild(m),a.appendChild(l),a.appendChild(c),t.appendChild(a),e.appendChild(t);const p=document.createElement("BUTTON");p.className="text-white bg-blue-700 hover:bg-blue-800 font-medium rounded text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700",p.textContent="Agregar",p.onclick=r,Modal.renderModal(e,p)},r=async()=>{const e=document.querySelector("#nota").value.trim(),t=document.querySelector("#image").files[0];if(""===e&&void 0===t)return void new Alerta({msg:"No puede dejar ambos campos vacíos",position:document.querySelector("#div-notif")});const o=new FormData;o.append("id_report",getSearch().folio),o.append("note",e),o.append("image",t);try{const t=`${location.origin}/api/nota-reporte`,n=await fetch(t,{method:"POST",body:o}),r=await n.json();if("Exito"===r.tipo){Swal.fire({title:r.tipo,text:r.mensaje,icon:"success"});const t=document.querySelector(".default-modal");t&&t.remove();const o={id:r.id,created:r.created,note:e,image:r.imagen};a=[...a,o],l()}}catch(e){console.log(e)}},l=()=>{let t=1;limpiarHTML(e),0!==a.length?a.forEach((a=>{const{note:o,image:n,created:r}=a,l=document.createElement("DIV");l.className="w-full flex flex-col sm:flex-row sm:justify-betweenn space-y-8 gap-4 p-4 sm:items-center bg-white dark:bg-gray-800 dark:border-gray-700";const d=document.createElement("DIV");if(d.className="sm:w-1/4 md:w-1/6",""===n)d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-32 mx-auto md:mx-0"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>';else{const e=document.createElement("IMG");e.src=`images/${n}`,e.alt="Nota-imagen",e.className="w-full block",d.appendChild(e)}l.appendChild(d);const c=document.createElement("DIV");c.className="sm:w-2/4 md:w-3/6 lg:w-4/6";const i=document.createElement("H3");i.className="text-lg font-bold tracking-tight text-gray-900 dark:text-white",i.textContent="Nota "+t++;const m=document.createElement("SPAN");m.className="text-base text-gray-500 dark:text-gray-400",m.textContent=r;const p=document.createElement("P");p.className="mt-3 mb-4 font-light text-base text-gray-500 dark:text-gray-400",p.textContent=""===o?"No se registró texto de nota":o;const g=document.createElement("DIV");g.className="sm:w-1/4 md:w-2/6 lg:flex-1 flex flex-col gap-2 lg:flex-row";const u=document.createElement("BUTTON");u.className="w-full px-2 py-2 md:py-1 text-xs leadindg-5 font-semibold rounded cursor-pointer bg-red-200 text-red-800 flex flew-row flex-nowrap items-center justify-center gap-2 uppercase hover:bg-red-300",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Eliminar</p>',u.onclick=()=>s(a);const x=document.createElement("BUTTON");x.className="w-full px-2 py-2 md:py-1 text-xs leadindg-5 font-semibold rounded cursor-pointer bg-green-200 text-green-800 flex flew-row flex-nowrap items-center justify-center gap-2 uppercase hover:bg-green-300",x.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 dark:text-white"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Agregar</p>',x.onclick=()=>agregarPDF(a),g.appendChild(x),g.appendChild(u),c.appendChild(i),c.appendChild(m),c.appendChild(p),l.appendChild(c),l.appendChild(g),e.appendChild(l)})):e.innerHTML='<p class="text-center text-gray-500 dark:text-gray-400 col-span-2">No hay notas registradas</p>'},s=e=>{Swal.fire({title:"¿Estás seguro de eliminar la nota?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&d(e)}))},d=async e=>{const t=`${location.origin}/api/nota-reporte/eliminar`,o=await PostDatos.eliminarDatos(t,e.id);"Exito"===o.tipo&&(Alerta.Toast.fire({title:o.tipo,text:o.mensaje,icon:"success"}),a=[...a].filter((e=>e.id!==o.id)),l())}})();