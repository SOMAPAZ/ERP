import GetDatos from"../classes/GetData_v1.js";import PostDatos from"../classes/PostData_v1.js";import Alerta from"../classes/Alerta_v1.js";import{formatDateText,getSearch,limpiarHTML}from"../helpers/index_v1.js";import Generador from"../classes/Generador_v1.js";(()=>{const e=document.querySelector("#listado-reportes"),t=document.querySelector("#total-reportes"),n=document.querySelector("#titulo-estado"),o=document.querySelector("#btn-anterior"),a=document.querySelector("#btn-siguiente"),r=document.querySelector("#total-rep"),s=document.querySelector("#inicio-mostrado"),d=document.querySelector("#fin-mostrado"),l=document.querySelector("#total-rep-sm"),c=document.querySelector("#inicio-mostrado-sm"),i=document.querySelector("#fin-mostrado-sm");let m=[],p=[];const u=["Reportes Abiertos","Reportes en Proceso","Reportes Cerrados","Reportes Terminados"];let x=0;const f=100;let g=1;const h=getSearch().s??1;document.addEventListener("DOMContentLoaded",(()=>{y(),o.addEventListener("click",k),a.addEventListener("click",w)}));const y=async()=>{n.textContent=u[Number(h)-1],p=[{s:h},{limit:f},{offset:v()}];const e=Generador.getDatos("api-reportes",p),t=await GetDatos.consultar(e);m=t.reportes,x=t.total,C()},C=()=>{if(limpiarHTML(e),0===m.length){const t=document.createElement("P");return t.className="py-5 text-center uppercase font-bold text-gray-800 dark:text-gray-300",t.textContent=`No hay ${u[Number(h)-1]}`,e.appendChild(t),void document.querySelector("#paginacion").classList.add("hidden")}t.textContent=`(${x})`,r.textContent=`${x}`,l.textContent=`${x}`,s.textContent=`${v()+1}`,c.textContent=`${v()+1}`;const n=v()+100>=x?x:v()+100;d.textContent=`${n}`,i.textContent=`${n}`,m.forEach((t=>{const n=document.createElement("DIV");n.className="space-y-4 py-2 md:py-4";const o=document.createElement("DIV");o.className="grid grid-cols-1 md:grid-cols-2 gap-4";const a=document.createElement("A");a.className="text-xl font-extrabold text-gray-900 dark:text-white uppercase hover:underline",a.href=`/reporte?folio=${t.id}`,a.innerHTML=`Folio: <span class="font-semibold ms-2">${t.id}</span>`;const r=document.createElement("DIV"),s=document.createElement("SPAN");s.className=`inline-block rounded bg-${t.id_priority.color}-100 px-2.5 py-0.5 text-xs font-extrabold text-${t.id_priority.color}-800 dark:bg-${t.id_priority.color}-900 dark:text-${t.id_priority.color}-300 md:mb-0 uppercase`,s.textContent=t.id_priority.name,r.appendChild(s),o.appendChild(a),o.appendChild(r);const d=document.createElement("DIV");d.className="grid md:grid-cols-2 gap-2 md:gap-6 col-span-2 text-base text-gray-900 dark:text-white";const l=document.createElement("DIV");l.className="space-y-2";const c=document.createElement("DIV");c.className="flex flex-col md:flex-row md:gap-2";const i=document.createElement("P");i.className="block font-bold py-1",i.innerHTML=`Usuario: <span class="font-normal text-gray-500 dark:text-gray-400"> ${t.name} </span>`,c.appendChild(i),l.appendChild(c);const m=document.createElement("DIV");m.className="flex flex-col md:flex-row md:gap-2";const p=document.createElement("P");p.className="block font-bold py-1",p.innerHTML=`Dirección: <span class="font-normal text-gray-500 dark:text-gray-400"> ${t.address} </span>`,m.appendChild(p),l.appendChild(m);const u=document.createElement("DIV");u.className="flex flex-col md:flex-row md:gap-2";const x=document.createElement("P");x.className="block font-bold py-1",x.innerHTML=`Emisión: <span class="font-normal text-gray-500 dark:text-gray-400"> ${formatDateText(t.created)} </span>`,u.appendChild(x),l.appendChild(u);const f=document.createElement("DIV");f.className="space-y-2";const g=document.createElement("DIV");g.className="flex flex-col md:flex-row md:gap-2";const h=document.createElement("P");h.className="block font-bold py-1",h.innerHTML=`Categoría: <span class="font-normal text-gray-500 dark:text-gray-400"> ${t.id_category} </span>`,g.appendChild(h),f.appendChild(g);const y=document.createElement("DIV");y.className="flex flex-col md:flex-row md:gap-2";const C=document.createElement("P");C.className="block font-bold py-1",C.innerHTML=`Incidencia: <span class="font-normal rounded px-2 py-1 \n      ${"5"===t.id_incidence.id?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":"10"===t.id_incidence.id||"20"===t.id_incidence.id?"bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-gray-100":"text-gray-500 dark:text-gray-400"}"> ${t.id_incidence.name} </span>`,y.appendChild(C),f.appendChild(y);const E=document.createElement("DIV");E.className="flex justify-center md:justify-end gap-1 col-span-2 md:col-span-1";const k=document.createElement("DIV"),w=document.createElement("A");w.className="flex items-center justify-center w-full uppercase bg-blue-600 text-font-light text-xs py-1 px-3 rounded-md shadow-md hover:bg-blue-500 gap-2",w.href=`/reporte?folio=${t.id}`,w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Acceder</p>';const v=document.createElement("DIV"),D=document.createElement("BUTTON");D.className="flex items-center justify-center w-full uppercase bg-red-600 text-font-light text-xs py-1 px-3 rounded-md shadow-md hover:bg-red-500 gap-2",D.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Eliminar</p>',D.onclick=()=>b(t.id),k.appendChild(w),v.appendChild(D),E.appendChild(k),E.appendChild(v),f.appendChild(E),d.appendChild(l),d.appendChild(f),n.appendChild(o),n.appendChild(d),e.appendChild(n)}))},b=e=>{Swal.fire({title:`¿Estás seguro de eliminar el reporte ${e}?`,text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&E(e)}))},E=async e=>{const t=`${location.origin}/api/reporte/eliminar`,n=await PostDatos.eliminarDatos(t,e,"folio");"Exito"===n.tipo&&(Alerta.Toast.fire({title:n.tipo,text:n.mensaje,icon:"success"}),m=[...m].filter((e=>e.id!==n.folio)),C())},k=()=>{if(g--,1===g)return y(),a.classList?.remove("hidden"),void o.classList.add("hidden");g<=Math.ceil(x/f)&&a.classList.remove("hidden"),p=[{s:h},{limit:f},{offset:v()}],y()},w=()=>{if(g===Math.floor(x/f))return g=Math.ceil(x/f),y(),a.classList.add("hidden"),void(g>1&&o.classList?.remove("hidden"));m.length<f?a.classList.add("hidden"):(g++,console.log(g),g>1&&o.classList.remove("hidden"),p=[{s:h},{limit:f},{offset:v()}],y())},v=()=>g-1==0?0:(g-1)*f})();