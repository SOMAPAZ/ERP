import Alerta from"../classes/Alerta.js";import GetDatos from"../classes/GetData.js";import PostDatos from"../classes/PostData.js";import{formatDateText,limpiarHTML,getSearch}from"../helpers/index.js";(()=>{const e=document.querySelector("#nombre"),t=document.querySelector("#idUser"),n=document.querySelector("#direccion"),a=document.querySelector("#telefono"),o=document.querySelector("#beneficiario"),r=document.querySelector("#categoria"),i=document.querySelector("#incidencia"),s=document.querySelector("#prioridad"),c=document.querySelector("#resetear-formulario"),d=document.querySelector("#coincidencias-usuario"),l=document.querySelector("#coincidencias-ID"),p=document.querySelector("#formulario-reporte"),m=document.querySelector("#reporte-reciente");let u=[],x=[],g=[],f={};document.addEventListener("DOMContentLoaded",(()=>{y(),e.addEventListener("input",h),t.addEventListener("input",v),r.addEventListener("change",(e=>k(e.target.value))),c.addEventListener("click",(()=>p.reset())),p.addEventListener("submit",b)}));const y=async()=>{[u,x,g,f]=await Promise.all([GetDatos.consultar(`${location.origin}/api/users`),GetDatos.consultar(`${location.origin}/api/prioridades`),GetDatos.consultar(`${location.origin}/api/categorias`),GetDatos.consultar(`${location.origin}/api/reporteID?folio=${getSearch().folio}`)]),D(s,x,f.id_priority.id),D(r,g,f.id_category.id),k(f.id_category.id)},b=async e=>{e.preventDefault();const t=await PostDatos.guardarDatos(`${location.origin}/api/reporte/editar`,p.querySelectorAll(".input-report"));"Exito"===t.tipo&&(p.reset(),Swal.fire({icon:"success",title:"Proceso exitoso",text:t.mensaje}),$(t.reporte))},h=()=>{const t=e.value.trim().toLowerCase();if(""===t||t.length<3)return;limpiarHTML(d),[...u].filter((e=>e.nombre.toLowerCase().includes(t.toLowerCase()))).forEach((e=>{const t=document.createElement("LI");t.className="block rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 dark:bg-gray-800 dark:text-gray-200 uppercase cursor-pointer",t.onclick=()=>E(e,d),t.textContent=e.nombre,d.appendChild(t)}))},v=()=>{const e=t.value.trim();if(""===e||0==e)return;limpiarHTML(l),[...u].filter((t=>t.id.includes(e))).forEach((e=>{const t=document.createElement("LI");t.className="block rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 dark:bg-gray-800 dark:text-gray-200 uppercase cursor-pointer",t.onclick=()=>E(e,l),t.textContent=`${e.id} - ${e.nombre}`,l.appendChild(t)}))},k=async e=>{if(limpiarHTML(i),""===e)return i.setAttribute("disabled","disabled"),void limpiarHTML(i);i.removeAttribute("disabled");const t=await PostDatos.enviarArray(`${location.origin}/api/incidencias`,e);"error"!==t.tipo?t.datos.forEach((e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.name,f.id_incidence.id==e.id&&t.setAttribute("selected",!0),i.appendChild(t)})):i.setAttribute("disabled","disabled")},$=e=>{limpiarHTML(m);const t=document.createElement("DIV");t.className="grid grid-cols-2 gap-4";const n=document.createElement("A");n.className="text-xl font-extrabold text-gray-900 dark:text-white uppercase hover:underline",n.href=`/reporte?folio=${e.id}`,n.innerHTML=`Folio: <span class="font-semibold ms-2">${e.id}</span>`;const a=x.filter((t=>t.name===e.id_priority)).shift(),o=document.createElement("DIV"),r=document.createElement("SPAN");r.className=`inline-block rounded bg-${a.color}-100 px-2.5 py-0.5 text-xs font-extrabold text-${a.color}-800 dark:bg-${a.color}-900 dark:text-${a.color}-300 md:mb-0 uppercase`,r.textContent=a.name,o.appendChild(r),t.appendChild(n),t.appendChild(o);const i=document.createElement("DIV");i.className="grid md:grid-cols-2 gap-2 md:gap-6 col-span-2 text-base text-gray-900 dark:text-white";const s=document.createElement("DIV");s.classList.add("space-y-2"),s.innerHTML=`\n      <div class="flex flex-col md:flex-row md:gap-2 uppercase">\n        <p class="block font-bold py-1">\n            Usuario: <span class="font-normal text-gray-500 dark:text-gray-400">${e.name}</span>\n        </p>\n      </div>\n      <div class="flex flex-col md:flex-row md:gap-2">\n        <p class="block font-bold py-1">\n            Dirección: <span class="font-normal text-gray-500 dark:text-gray-400">${e.address}</span>\n        </p>\n      </div>\n      <div class="flex flex-col md:flex-row md:gap-2">\n        <p class="block font-bold py-1"> Fecha emisión: \n          <span class="font-normal text-gray-500 dark:text-gray-400">${e.created}</span>\n        </p>\n      </div>\n    `;const c=document.createElement("DIV");c.classList.add("space-y-2"),c.innerHTML=`\n      <div class="flex flex-col md:flex-row md:gap-2 uppercase">\n          <p class="block font-bold py-1">\n              Categoría:\n              <span class="font-normal text-gray-500 dark:text-gray-400">\n                  ${e.id_category}\n              </span>\n          </p>\n      </div>\n      <div class="flex flex-col md:flex-row md:gap-2">\n          <p class="block font-bold py-1">\n              Incidencia:\n              <span class="font-normal text-gray-500 dark:text-gray-400">\n                ${e.id_incidence}\n              </span>\n          </p>\n      </div>\n    `;const d=document.createElement("DIV");d.className="flex justify-center md:justify-end gap-1 col-span-2 md:col-span-1";const l=document.createElement("DIV"),p=document.createElement("A");p.className="flex items-center justify-center w-full uppercase bg-blue-600 text-font-light text-xs py-2 px-6 rounded-md shadow-md hover:bg-blue-500 gap-2",p.href=`/reporte?folio=${e.id}`,p.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>\n        <p class="font-bold text-xs">Acceder</p>\n      ';const u=document.createElement("DIV"),g=document.createElement("BUTTON");g.className="flex items-center justify-center w-full uppercase bg-cyan-600 text-font-light text-xs py-2 px-6 rounded-md shadow-md hover:bg-cyan-500 gap-2",g.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0 0 15 2.25h-1.5a2.251 2.251 0 0 0-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 0 0-9-9Z" /></svg>\n        <p class="font-bold text-xs">Copiar</p>\n      ',g.onclick=()=>w(e),l.appendChild(p),u.appendChild(g),d.appendChild(l),d.appendChild(u),c.appendChild(d),i.appendChild(s),i.appendChild(c),m.appendChild(t),m.appendChild(i)},w=e=>{const t=`*REPORTE EDITADO:*\n\n*Folio:* ${e.id}\n*ID Usuario:* ${e.id_user}\n*Nombre:* ${e.name}\n*Direccion:* ${e.address}\n*Emision:* ${formatDateText(e.created)}\n*Categoria:* ${e.id_category}\n*Incidencia:* ${e.id_incidence}\n*Prioridad:* ${e.id_priority}`;navigator.clipboard.writeText(t)&&Alerta.Toast.fire({title:"Exito",text:"Texto copiado al portapapeles",icon:"success"})},E=async(r,i)=>{const s=await GetDatos.consultar(`${location.origin}/api/usuario?id=${r.id}`);e.value=`${s.user} ${s.lastname}`,t.value=s.id,n.value=s.address,a.value="0"===s.phone?"s/#":s.phone,o.value="s/n",limpiarHTML(i)},D=(e,t,n)=>{t.forEach((t=>{const a=document.createElement("OPTION");a.value=t.id,a.textContent=t.name,n==t.id&&a.setAttribute("selected",!0),e.appendChild(a)}))}})();