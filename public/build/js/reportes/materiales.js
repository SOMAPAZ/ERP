import GetDatos from"../classes/GetData.js";import Modal from"../classes/Modal.js";import PostDatos from"../classes/PostData.js";import Alerta from"../classes/Alerta.js";import{getSearch,limpiarHTML}from"../helpers/index.js";(()=>{const e=document.querySelector("#btn-add-material"),t=document.querySelector("#render-materiales");let a=[],r=[],n=[];document.addEventListener("DOMContentLoaded",(()=>{o(),e.addEventListener("click",(()=>l()))}));const o=async()=>{[a,r,n]=await Promise.all([GetDatos.consultar(`${location.origin}/api/materiales`),GetDatos.consultar(`${location.origin}/api/unidades`),GetDatos.consultar(`${location.origin}/api/materiales-reportes?id_report=${getSearch().folio}`)]),c()},l=()=>{const e=document.createElement("DIV");e.className="p-4 md:p-5 space-y-4";const t=document.createElement("FORM");t.id="formulario-add-material",t.setAttribute("autocomplete","off");const a=document.createElement("DIV");a.className="flex flex-col gap-6";const n=document.createElement("H3");n.className="text-lg font-medium text-gray-900 dark:text-white mb-5",n.textContent="Ingrese los datos solicitados";const o=document.createElement("DIV");o.id="div-notif",t.appendChild(n),t.appendChild(o);const l=document.createElement("INPUT");l.value=getSearch().folio,l.classList.add("hidden","input-form"),l.name="id_report";const i=document.createElement("DIV"),c=document.createElement("LABEL");c.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white uppercase",c.for="material",c.textContent="Ingrese el material";const m=document.createElement("INPUT");m.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase input-form",m.type="text",m.name="material",m.id="material",m.placeholder="Ingrese el material",m.oninput=d,i.appendChild(c),i.appendChild(m);const p=document.createElement("DIV");p.id="contenedorMateriales",i.appendChild(p),a.appendChild(i),function(e,t,a){const r=document.createElement("DIV"),n=document.createElement("LABEL");n.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white uppercase",n.for=a,n.textContent=a;const o=document.createElement("INPUT");o.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase input-form",o.type=t,o.name=a,o.id=a,o.placeholder=`Ingrese ${a}`,r.appendChild(n),r.appendChild(o),e.appendChild(r)}(a,"number","quantity");const u=document.createElement("DIV"),g=document.createElement("LABEL");g.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white",g.for="unidad",g.textContent="Ingrese la unidad";const x=document.createElement("SELECT");x.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase input-form",x.name="id_unity",x.id="unidad";const f=document.createElement("OPTION");f.value="",f.textContent="- Seleccione una unidad -",x.appendChild(f),r.forEach((e=>{const{id:t,name:a}=e,r=document.createElement("OPTION");r.value=t,r.textContent=a,x.appendChild(r)})),u.appendChild(g),u.appendChild(x),a.appendChild(u),t.appendChild(l),t.appendChild(a);const y=document.createElement("BUTTON");y.className="text-white bg-blue-700 hover:bg-blue-800 font-medium rounded text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 ",y.textContent="Agregar",y.onclick=s,e.appendChild(t),Modal.renderModal(e,y)},d=e=>{const t=e.target.value.trim();if(""===t){const e=document.querySelector("#contenedorMateriales");return void limpiarAnterior(e)}const r=[...a].filter((e=>e.name.includes(t)));i(r)},i=e=>{const t=document.querySelector("#contenedorMateriales");limpiarHTML(t);const a=document.createElement("UL");if(a.classList.add("space-y-1","z-40","mt-2"),0===e.length){const e=document.createElement("LI");return e.className="block rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 dark:bg-gray-800 dark:text-gray-200 uppercase cursor-pointer",e.textContent="Sin coincidencias",e.onclick=()=>limpiarHTML(t),a.appendChild(e),void t.appendChild(a)}e.forEach((e=>{const r=document.createElement("LI");r.className="block rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 dark:bg-gray-800 dark:text-gray-200 uppercase cursor-pointer",r.onclick=function(){m(e,t)},r.textContent=e.name,a.appendChild(r),t.appendChild(a)}))},c=()=>{limpiarHTML(t),0!==n.length?n.forEach((e=>{const{quantity:a,id_unity:r,material:n}=e,o=document.createElement("DIV");o.className="w-full flex flex-col sm:flex-row sm:justify-betweenn gap-4 p-2 sm:items-center bg-white dark:bg-gray-800 dark:border-gray-700";const l=document.createElement("DIV");l.className="sm:w-3/4 md:w-4/6 lg:w-3/4 bg-white dark:bg-gray-800 flex p-4 items-center";const d=document.createElement("P");d.className="font-medium text-gray-800 dark:text-white",d.textContent=`${a} ${r} de ${n}`,l.appendChild(d);const i=document.createElement("DIV");i.className="sm:w-1/4 md:w-2/6 lg:w-1/4 flex flex-col gap-2 lg:flex-row justify-end";const c=document.createElement("BUTTON");c.className="w-full lg:w-auto px-2 py-2 md:py-1 text-xs leadindg-5 font-semibold rounded cursor-pointer bg-red-200 text-red-800 flex flew-row flex-nowrap items-center justify-center gap-2 uppercase hover:bg-red-300",c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg><p class="font-bold text-xs">Eliminar</p>',c.onclick=()=>p(e),i.appendChild(c),o.appendChild(l),o.appendChild(i),t.appendChild(o)})):t.innerHTML='<p class="text-center text-gray-500 dark:text-gray-400 mt-5">No hay materiales registrados</p>'},s=async()=>{const e=`${location.origin}/api/material`,t=document.querySelectorAll(".input-form"),a=await PostDatos.guardarDatos(e,t);if("Exito"===a.tipo){Alerta.Toast.fire({title:a.tipo,text:a.mensaje,icon:"success"});const e=document.querySelector(".default-modal");e&&e.remove();const t={id:a.id,quantity:a.cantidad,id_report:getSearch().folio,id_unity:a.unidad,material:a.material};n=[...n,t],c()}};const m=(e,t)=>{limpiarHTML(t);t.parentElement.querySelector("INPUT").value=e.name},p=e=>{Swal.fire({title:"¿Estás seguro de eliminar el material?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&u(e)}))},u=async e=>{const t=`${location.origin}/api/material/eliminar`,a=await PostDatos.eliminarDatos(t,e.id);"Exito"===a.tipo?(Alerta.Toast.fire({icon:"success",title:"Proceso exitoso",text:a.mensaje}),n=[...n].filter((e=>e.id.toString()!==a.id.toString())),c()):Alerta.Toast.fire({icon:"error",title:"Upss!",text:"Ocurrio un error"})}})();