(()=>{const e=document.querySelector("#btn-add-material"),t=document.querySelector("#render-materiales");let a,n=[],r=[],o=[];function d(e){const t=e.target.value.trim();if(""===t){return void i(document.querySelector("#contenedorMateriales"))}!function(e){const t=document.querySelector("#contenedorMateriales");i(t);const n=document.createElement("UL");if(n.classList.add("space-y-1","z-40","mt-2"),0===e.length){const e=document.createElement("LI");return e.classList.add("block","rounded-lg","bg-gray-100","px-4","py-2","text-sm","font-medium","text-gray-700","dark:bg-gray-800","dark:text-gray-200","uppercase","cursor-pointer"),e.textContent="Sin coincidencias",e.onclick=()=>{i(t)},n.appendChild(e),void t.appendChild(n)}e.forEach((e=>{const r=document.createElement("LI");r.classList.add("block","rounded-lg","bg-gray-100","px-4","py-2","text-sm","font-medium","text-gray-700","dark:bg-gray-800","dark:text-gray-200","uppercase","cursor-pointer"),r.onclick=function(){!function(e,t){i(t);t.parentElement.querySelector("INPUT").value=e.name}(e,t),a=e.id},r.textContent=e.name,n.appendChild(r),t.appendChild(n)}))}([...n].filter((e=>e.name.includes(t))))}function c(){i(t),0!==o.length?o.forEach((e=>{const{cantidad:a,unidad:n,material:r}=e;console.log(e);const o=document.createElement("DIV");o.className="bg-gray-100 dark:bg-gray-800 rounded flex p-4 h-full items-center text-xs",o.innerHTML='                    \n      <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" class="text-indigo-400 w-6 h-6 flex-shrink-0 mr-4" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"></path><path d="M22 4L12 14.01l-3-3"></path></svg>\n      ';const d=document.createElement("SPAN");d.className="title-font font-medium text-gray-800 dark:text-white",d.textContent=`${a} ${n} de ${r}`,o.appendChild(d),t.appendChild(o)})):t.innerHTML='<p class="text-center text-gray-500 dark:text-gray-400 col-span-2">No hay materiales registrados</p>'}async function l(e){const t=e.target.parentElement.parentElement,n=t.querySelector("#material").value.trim(),r=t.querySelector("#unidad").value.trim(),d=t.querySelector("#cantidad").value.trim();if(""===n||""===r||""===d)return void function(e){const t=document.createElement("DIV");t.className="rounded border-s-4 mt-3 border-red-500 bg-red-50 p-4 dark:border-red-600 dark:bg-red-900 alerta",t.innerHTML=`<strong class="block font-medium text-red-700 dark:text-red-200">${e}</strong>`,document.querySelector(".alerta")?.remove();const a=document.querySelector("#formulario-add-material");a.parentElement.insertBefore(t,a),setTimeout((()=>{t.remove()}),5e3)}("Todos los campos son obligatorios");const l=new FormData;l.append("id_report",s()),l.append("id_material",a),l.append("id_unity",r),l.append("quantity",d);try{const e=`${location.origin}/api/material`,t=await fetch(e,{method:"POST",body:l}),a=await t.json();if(console.log(a),"Exito"===a.tipo){Swal.fire({title:a.tipo,text:a.mensaje,icon:"success"});const e=document.querySelector(".modal-form");e&&e.remove();const t={cantidad:d,id_report:s(),unidad:a.unidad,material:a.material};console.log(t),o=[...o,t],c()}}catch(e){console.log(e)}}function i(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function s(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).folio}document.addEventListener("DOMContentLoaded",(()=>{!async function(){try{const e=`${location.origin}/api/materiales`,t=await fetch(e),a=await t.json();n=a}catch(e){console.log(e)}}(),async function(){try{const e=`${location.origin}/api/unidades`,t=await fetch(e),a=await t.json();r=a}catch(e){console.log(e)}}(),async function(){const e=new FormData;e.append("id_report",s());try{const t=`${location.origin}/api/materiales-reportes`,a=await fetch(t,{method:"POST",body:e}),n=await a.json();o=n,c()}catch(e){console.log(e)}}(),e.addEventListener("click",(()=>{!function(){const e=document.createElement("DIV");e.className="overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 bottom-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%)] max-h-full bg-gray-800 bg-opacity-50 dark:bg-opacity-80 modal-form";const t=document.createElement("DIV");t.className="relative p-4 w-full max-w-2xl mx-auto mt-20 max-h-full";const a=document.createElement("DIV");a.className="relative bg-white rounded-lg shadow dark:bg-gray-700";const n=document.createElement("DIV");n.className="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600";const o=document.createElement("H3");o.className="text-xl font-semibold text-gray-900 dark:text-white",o.textContent="Añadir información",n.appendChild(o);const c=document.createElement("DIV");c.className="p-4 md:p-5 space-y-4";const i=document.createElement("FORM");i.id="formulario-add-material",i.setAttribute("autocomplete","off");const s=document.createElement("DIV");s.className="flex flex-col gap-6";const m=document.createElement("DIV"),u=document.createElement("LABEL");u.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white uppercase",u.for="material",u.textContent="Ingrese el material";const p=document.createElement("INPUT");p.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase",p.type="text",p.name="material",p.id="material",p.placeholder="Ingrese el material",p.oninput=d,m.appendChild(u),m.appendChild(p);const g=document.createElement("DIV");g.id="contenedorMateriales",m.appendChild(g),s.appendChild(m),function(e,t,a){const n=document.createElement("DIV"),r=document.createElement("LABEL");r.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white uppercase",r.for=a,r.textContent=a;const o=document.createElement("INPUT");o.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase",o.type=t,o.name=a,o.id=a,o.placeholder=`Ingrese ${a}`,n.appendChild(r),n.appendChild(o),e.appendChild(n)}(s,"number","cantidad");const f=document.createElement("DIV"),h=document.createElement("LABEL");h.className="block mb-2 text-sm font-medium text-gray-900 dark:text-white",h.for="unidad",h.textContent="Ingrese la unidad";const y=document.createElement("SELECT");y.className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white uppercase",y.name="unidad",y.id="unidad";const x=document.createElement("OPTION");x.value="",x.textContent="- Seleccione una unidad -",y.appendChild(x),r.forEach((e=>{const{id:t,name:a}=e,n=document.createElement("OPTION");n.value=t,n.textContent=a,y.appendChild(n)})),f.appendChild(h),f.appendChild(y),s.appendChild(f),i.appendChild(s);const b=document.createElement("DIV");b.className="flex items-center justify-end gap-4 p-4 md:p-5 border-t border-gray-200 rounded-b dark:border-gray-600";const k=document.createElement("BUTTON");k.className="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",k.textContent="Agregar",k.onclick=l;const C=document.createElement("BUTTON");C.className="text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800",C.textContent="Cancelar",C.onclick=()=>document.querySelector(".modal-form")?.remove(),c.appendChild(i),b.appendChild(C),b.appendChild(k),a.appendChild(n),a.appendChild(c),a.appendChild(b),t.appendChild(a),e.appendChild(t),document.querySelector("main").appendChild(e)}()}))}))})();