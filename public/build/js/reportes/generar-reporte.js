(()=>{const e=document.querySelector("#nombre"),t=document.querySelector("#idUser"),n=document.querySelector("#direccion"),o=document.querySelector("#telefono"),a=document.querySelector("#beneficiario"),c=document.querySelector("#descripcion"),r=document.querySelector("#categoria"),i=document.querySelector("#incidencia"),d=document.querySelector("#prioridad"),l=document.querySelector("#resetear-formulario"),s=document.querySelector("#coincidencias-usuario"),p=document.querySelector("#coincidencias-ID"),u=document.querySelector("#formulario-reporte"),m=document.querySelector("#reporte-reciente");let f=[],g=[],x=[],v=[];async function y(e){const t=new FormData;t.append("id_category",e);try{const e=`${location.origin}/api/incidencias`,n=await fetch(e,{method:"POST",body:t}),o=await n.json();if(v=o.datos,"error"===o.tipo)return void i.setAttribute("disabled","disabled");!function(e){$(i);const t=document.createElement("OPTION");t.value="",t.textContent="- Seleccione una incidencia -",i.appendChild(t),e.forEach((e=>{const{id:t,name:n}=e,o=document.createElement("OPTION");o.value=t,o.textContent=n,i.appendChild(o)}))}(o.datos)}catch(e){console.log(e)}}async function h(l){l.preventDefault();const s=e.value.trim(),p=t.value.trim(),f=n.value.trim(),y=o.value.trim(),h=a.value.trim(),b=r.value.trim(),C=i.value.trim(),w=d.value.trim(),k=c.value.trim(),E={nombre:s,direccion:f,categoria:b,incidencia:C,prioridad:w,descripcion:k};if(Object.values(E).some((e=>""===e)))return void function(e){const t=document.createElement("DIV");t.className="rounded border-s-4 mt-6 border-red-500 bg-red-50 p-4 dark:border-red-600 dark:bg-red-900 alerta",t.innerHTML=`<strong class="block font-medium text-red-700 dark:text-red-200">${e}</strong>`,document.querySelector(".alerta")?.remove(),u.parentElement.insertBefore(t,u),setTimeout((()=>{t.remove()}),5e3)}("Los campos: Nombre, Dirección, Categoria, Incidencia, Prioridad y Descripción son requeridos");const S=new FormData;S.append("id_user",p),S.append("name",s),S.append("phone",y),S.append("address",f),S.append("id_beneficiary",h),S.append("id_category",b),S.append("id_incidence",C),S.append("id_priority",w),S.append("description",k);try{const e=`${location.origin}/api/reporte`,t=await fetch(e,{method:"POST",body:S}),n=await t.json();"Exito"===n.tipo&&(u.reset(),Swal.fire({title:n.tipo,text:n.mensaje,icon:"success"}),function(e,t){$(m);const n=document.createElement("DIV");n.className="grid grid-cols-2 gap-4";const o=document.createElement("A");o.className="text-xl font-extrabold text-gray-900 dark:text-white uppercase hover:underline",o.href=`/reporte?folio=${e.folio}`,o.innerHTML=`Folio: <span class="font-semibold ms-2">${e.folio}</span>`;const a=g.filter((t=>t.id===e.prioridad)),c=x.filter((e=>e.id===t.categoria)),r=v.filter((e=>e.id===t.incidencia)),i=[...a].shift(),d=[...r].shift(),l=[...c].shift(),s=document.createElement("DIV"),p=document.createElement("SPAN");p.className=`inline-block rounded bg-${i.color}-100 px-2.5 py-0.5 text-xs font-extrabold text-${i.color}-800 dark:bg-${i.color}-900 dark:text-${i.color}-300 md:mb-0 uppercase`,p.textContent=i.name,s.appendChild(p),n.appendChild(o),n.appendChild(s);const u=document.createElement("DIV");u.className="grid md:grid-cols-2 gap-2 md:gap-6 col-span-2 text-base text-gray-900 dark:text-white";const f=document.createElement("DIV");f.classList.add("space-y-2"),f.innerHTML=`\n      <div class="flex flex-col md:flex-row md:gap-2 uppercase">\n        <p class="block font-bold py-1">\n            Usuario: <span class="font-normal text-gray-500 dark:text-gray-400">${t.nombre}</span>\n        </p>\n      </div>\n      <div class="flex flex-col md:flex-row md:gap-2">\n        <p class="block font-bold py-1">\n            Dirección: <span class="font-normal text-gray-500 dark:text-gray-400">${t.direccion}</span>\n        </p>\n      </div>\n      <div class="flex flex-col md:flex-row md:gap-2">\n        <p class="block font-bold py-1"> Fecha emisión: \n          <span class="font-normal text-gray-500 dark:text-gray-400">${e.fecha}</span>\n        </p>\n      </div>\n    `;const y=document.createElement("DIV");y.classList.add("space-y-2"),y.innerHTML=`\n      <div class="flex flex-col md:flex-row md:gap-2 uppercase">\n          <p class="block font-bold py-1">\n              Categoría:\n              <span class="font-normal text-gray-500 dark:text-gray-400">\n                  ${l.name}\n              </span>\n          </p>\n      </div>\n      <div class="flex flex-col md:flex-row md:gap-2">\n          <p class="block font-bold py-1">\n              Incidencia:\n              <span class="font-normal text-gray-500 dark:text-gray-400">\n                ${d.name}\n              </span>\n          </p>\n      </div>\n    `;const h=document.createElement("DIV");h.className="flex justify-center md:justify-end gap-1 col-span-2 md:col-span-1";const b=document.createElement("DIV"),C=document.createElement("A");C.className="flex items-center justify-center w-full uppercase bg-blue-600 text-font-light text-xs py-2 px-6 rounded-md shadow-md hover:bg-blue-500 gap-2",C.href=`/reporte?folio=${e.folio}`,C.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>\n        <p class="font-bold text-xs">Acceder</p>\n      ';const w=document.createElement("DIV"),k=document.createElement("BUTTON");k.className="flex items-center justify-center w-full uppercase bg-cyan-600 text-font-light text-xs py-2 px-6 rounded-md shadow-md hover:bg-cyan-500 gap-2",k.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0 0 15 2.25h-1.5a2.251 2.251 0 0 0-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 0 0-9-9Z" /></svg>\n        <p class="font-bold text-xs">Copiar</p>\n      ',k.onclick=()=>{!function(e,t,n,o,a){const c=`Folio: ${e.folio}\nID Usuario: ${e.idUser}\nNombre: ${t.nombre}\nDireccion: ${t.direccion}\nEmision: ${e.fecha}\nCategoria: ${a.name}\nIncidencia: ${o.name}\nPrioridad: ${n.name}`;navigator.clipboard.writeText(c)&&Swal.fire({title:"Exito",text:"Texto copiado al portapapeles",icon:"success"})}(e,t,i,d,l)},b.appendChild(C),w.appendChild(k),h.appendChild(b),h.appendChild(w),y.appendChild(h),u.appendChild(f),u.appendChild(y),m.appendChild(n),m.appendChild(u)}(n,E))}catch(e){console.log(e)}}function b(){$(s),f.forEach((t=>{const{nombre:n}=t,o=n.toLowerCase(),a=e.value.trim().toLowerCase();if(""!==a&&o.includes(a)){const e=document.createElement("LI");e.classList.add("block","rounded-lg","bg-gray-100","px-4","py-2","text-sm","font-medium","text-gray-700","dark:bg-gray-800","dark:text-gray-200","uppercase","cursor-pointer"),e.onclick=function(){E(t,s)},e.textContent=n,s.appendChild(e)}}))}function C(){$(p),f.forEach((e=>{const{id:n,nombre:o}=e,a=n,c=t.value;if(""!==c&&a.includes(c)){const t=document.createElement("LI");t.classList.add("block","rounded-lg","bg-gray-100","px-4","py-2","text-sm","font-medium","text-gray-700","dark:bg-gray-800","dark:text-gray-200","uppercase","cursor-pointer"),t.onclick=function(){E(e,p)},t.textContent=`${n} - ${o}`,p.appendChild(t)}}))}function w(e){const t=e.target.value;if(""===t)return i.setAttribute("disabled","disabled"),void $(i);i.removeAttribute("disabled"),y(t)}function k(){e.value="",t.value="",n.value="",o.value="",a.value="",$(s),$(p)}function E(c,r){e.value=c.nombre,t.value=c.id,n.value=c.direccion,o.value=c.telefono,a.value=null,$(r)}function $(e){for(;e.firstChild;)e.removeChild(e.firstChild)}document.addEventListener("DOMContentLoaded",(()=>{!async function(){try{const e=`${location.origin}/api/usuarios`,t=await fetch(e),n=await t.json();f=n}catch(e){console.log(e)}}(),async function(){try{const e=`${location.origin}/api/categorias`,t=await fetch(e),n=await t.json();x=n;const o=document.createElement("OPTION");o.value="",o.textContent="- Seleccione una categoría -",r.appendChild(o),n.forEach((e=>{const{id:t,name:n}=e,o=document.createElement("OPTION");o.value=t,o.textContent=n,r.appendChild(o)}))}catch(e){console.log(e)}}(),async function(){try{const e=`${location.origin}/api/prioridades`,t=await fetch(e),n=await t.json();g=n;const o=document.createElement("OPTION");o.value="",o.textContent="- Seleccione una prioridad -",d.appendChild(o),n.forEach((e=>{const{id:t,name:n}=e,o=document.createElement("OPTION");o.value=t,o.textContent=n,d.appendChild(o)}))}catch(e){console.log(e)}}(),e.addEventListener("input",b),t.addEventListener("input",C),r.addEventListener("change",w),l.addEventListener("click",k),u.addEventListener("submit",h)}))})();