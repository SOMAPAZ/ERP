import{formatDateText,getSearch}from"../helpers/index.js";import GetDatos from"../classes/GetData.js";import Alerta from"../classes/Alerta.js";(()=>{const e=document.querySelector("#adeudo-desglose tbody"),t=document.querySelector("#btn-pago-parcial"),a=document.querySelector("#btn-condonar-parcial"),n=(document.querySelector("#btn-condonar-recargos"),document.querySelector("#periodo-label"));let o=[],r=[],c=[],d=[];document.addEventListener("DOMContentLoaded",(()=>{l(),t.addEventListener("click",(()=>{p()})),a.addEventListener("click",(()=>{p(!0)}))}));const l=async()=>{const e=getSearch().usuario,t=`${location.origin}/api/usuario?id=${e}`,a=`${location.origin}/deuda-usuario?id=${e}`,n=`${location.origin}/deuda-desglosada?id=${e}`;[o,c,r]=await Promise.all([GetDatos.consultar(t),GetDatos.consultar(a),GetDatos.consultar(n)]),s()},s=()=>{const t=document.createElement("P");t.className="text-center my-5 py-5 text-sm uppercase font-bold border border-dashed border-gray-300 rounded dark:bg-gray-700 dark:text-gray-300",t.textContent=`Periodo: ${formatDateText(c.periodo.inicio)} a ${formatDateText(c.periodo.final)}`,n.appendChild(t),r.map((t=>{const a=document.createElement("TR");a.className="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",a.dataset.idx=t.idxDB;const n=document.createElement("TD");n.className="w-4 py-1 px-4";const o=document.createElement("INPUT");o.type="checkbox",o.className="w-6 h-6 text-blue-600 bg-gray-100 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 cursor-pointer",n.appendChild(o);const r=document.createElement("TH");r.scope="row",r.className="px-4 py-1 font-medium text-gray-900 whitespace-nowrap dark:text-white",r.textContent=t.year;const c=document.createElement("TD");c.className="px-4 py-1",c.textContent=t.mes;const d=document.createElement("TD");d.className="px-4 py-1",d.textContent=t.agua;const l=document.createElement("TD");l.className="px-4 py-1",l.textContent=t.drenaje;const s=document.createElement("TD");s.className="px-4 py-1",s.textContent=t.rec_agua;const p=document.createElement("TD");p.className="px-4 py-1",p.textContent=t.rec_drain;const m=document.createElement("TD");m.className="px-4 py-1",m.textContent=t.iva_agua;const u=document.createElement("TD");u.className="px-4 py-1",u.textContent=t.iva_drenaje;const x=document.createElement("TD");x.className="px-4 py-1",x.textContent=t.total.general;const g=document.createElement("TD");g.className="flex px-4 py-1 items-center";const y=document.createElement("BUTTON");y.className="font-medium text-blue-800 dark:text-blue-500 hover:underline text-xs uppercase font-black py-1",y.textContent="Pagar",y.onclick=()=>i(t);const C=document.createElement("BUTTON");C.className="font-medium text-red-800 dark:text-red-700 hover:underline ms-3 text-xs uppercase font-black py-1",C.textContent="Condonar",C.onclick=()=>i(t,!0),g.appendChild(y),g.appendChild(C),a.appendChild(n),a.appendChild(r),a.appendChild(c),a.appendChild(d),a.appendChild(s),a.appendChild(m),a.appendChild(l),a.appendChild(p),a.appendChild(u),a.appendChild(x),a.appendChild(g),e.appendChild(a)}))},i=(e,t=!1)=>{Swal.fire({title:t?`¿Realizar condonación por $${e.total.general} MN?`:`¿Realizar pago por $${e.total.general} MN?`,text:"Esta acción lleva un proceso de cancelación",icon:"warning",showCancelButton:!0,confirmButtonText:t?"Confirmar condonación":"Confirmar pago",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&(t?async function(){console.log("Condonando...")}():async function(){console.log("Pagando...")}())}))};function p(t=!1){const a=e.querySelectorAll("input[type='checkbox']:checked");0!==a.length?(a.forEach((e=>{const t=e.parentElement.parentElement;d.find((e=>e==t.dataset.idx))||(d=[...d,t.dataset.idx])})),console.log(d)):Alerta.Toast.fire({icon:"error",title:"Campos vacíos",text:"Debe seleccionar al menos dos meses"})}})();