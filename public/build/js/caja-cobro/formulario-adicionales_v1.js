import GetDatos from"../classes/GetData_v1.js";import Alerta from"../classes/Alerta_v1.js";import{getLocalStorage,limpiarHTML}from"../helpers/index_v1.js";(()=>{let e=[];const o=document.querySelector("#idUser"),t=document.querySelector("#nombre"),r=document.querySelector("#direccion"),a=document.querySelector("#tipo_pago"),i=document.querySelector("#listado-coincidencias-id"),n=document.querySelector("#listado-coincidencias-nombre"),c=document.querySelector("#btn-enviar-pago");document.addEventListener("DOMContentLoaded",(()=>{l(),o.addEventListener("input",s),t.addEventListener("input",d),c.addEventListener("click",m)}));const l=async()=>e=await GetDatos.consultar(`${location.origin}/api/users`),s=o=>{const t=o.target.value.trim();if(""===t)return void limpiarHTML(i);const r=[...e].filter((e=>`${e.id} - ${e.nombre}`.includes(t)));u(r,i)},d=o=>{const t=o.target.value.trim().toLowerCase();if(""===t||t.length<4)return void limpiarHTML(n);const r=[...e].filter((e=>`${e.nombre}`.includes(t)));u(r,n)},u=(e,a)=>{limpiarHTML(a),e.forEach((e=>{const i=document.createElement("LI");i.className="block rounded-lg bg-gray-100 hover:bg-gray-400 hover:text-white shadow text-gray-800 text-sm font-semibold px-2 py-2 text-center uppercase cursor-pointer dark:bg-gray-600 dark:text-white dark:hover:bg-gray-700 dark:hover:text-gray-400",i.textContent=`${e.id} - ${e.nombre}`,i.onclick=()=>((e,a)=>{limpiarHTML(a),o.value=e.id,t.value=e.nombre,r.value=e.direccion})(e,a),a.appendChild(i)}))},m=async()=>{const e=o.value,i=t.value,n=r.value,c=getLocalStorage("costosAdicionales");if(""===i||""===n||null===c||""===a.value)return void new Alerta({msg:"El nombre, dirección y tipo de pago son obligatorios, además debe ingresar al menos un costo",position:document.querySelector(".alertas")});const l=`${location.origin}/pago-parcial`;try{const o=new FormData;o.append("id",e),o.append("nombre",i),o.append("direccion",n),o.append("tipo_pago",a.value),o.append("adicionales",JSON.stringify(c));const t=await fetch(l,{method:"POST",body:o}),r=await t.json();"Exito"===r.tipo&&Swal.fire({title:`Pago guardado correctamente con folio ${r.folio}`,text:"El pago se ha guardado correctamente",icon:"success",confirmButtonText:"Mostrar recibo",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1}).then((e=>{e.isConfirmed&&(window.open(`pdf/recibo-adicionales?folio=${r.folio}&id=${r.id_user}`,"_blank"),location.href=`${location.origin}/consultar`)}))}catch(e){console.log(e)}}})();