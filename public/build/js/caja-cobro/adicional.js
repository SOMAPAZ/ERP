import Modal from"../classes/Modal_v1.js";import GetDatos from"../classes/GetData_v1.js";import Alerta from"../classes/Alerta_v1.js";import{saveLocalStorage,deleteLocalStorage,getLocalStorage,limpiarHTML,formatNum}from"../helpers/index_v1.js";(()=>{const e=document.querySelector("#btn-consto-adicional"),t=document.querySelector("#listado-adicionales ul");let a=[],o={},n=[];window.addEventListener("unload",(function(){getLocalStorage("costosAdicionales")&&deleteLocalStorage("costosAdicionales")})),document.addEventListener("DOMContentLoaded",(()=>{getLocalStorage("costosAdicionales")&&deleteLocalStorage("costosAdicionales"),r(),e.addEventListener("click",c)}));const r=async()=>{const e=`${location.origin}/cuentas-adicionales`;a=await GetDatos.consultar(e)},c=()=>{const e=document.createElement("FORM");e.className="flex flex-col gap-2 p-4 my-5 space-y-2";const t=document.createElement("DIV"),n=document.createElement("LABEL");n.className="block text-sm font-medium text-gray-700 dark:text-gray-400 uppercase my-1",n.textContent="Costo",n.htmlFor="costo";const r=document.createElement("INPUT");r.className="block w-full px-4 py-2 rounded-md border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white text-sm overflow-hidden text-ellipsis whitespace-nowrap",r.type="number",r.name="costo",r.id="costo",r.onchange=e=>o.cantidad=+e.target.value,t.appendChild(n),t.appendChild(r);const c=document.createElement("DIV"),d=document.createElement("LABEL");d.className="block text-sm font-medium text-gray-700 dark:text-gray-400 uppercase my-1",d.textContent="Descripción",d.htmlFor="adicional";const l=document.createElement("SELECT");l.className="block w-full px-4 py-2 rounded-md border border-gray-200 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white text-sm overflow-hidden text-ellipsis whitespace-nowrap",l.name="adicional",l.id="adicional",l.onchange=e=>{o=a.find((t=>t.id===e.target.value)),r.value=+o.cantidad??0};const i=document.createElement("OPTION");i.classList.add("text-sm","truncate"),i.value="",i.textContent="-- Seleccione una opción --",l.appendChild(i),a.forEach((e=>{const t=document.createElement("OPTION");t.classList.add("text-xs","truncate"),t.value=e.id,t.textContent=e.cuenta.length>=48?`${e.cuenta.substring(0,48)} ...`:e.cuenta,l.appendChild(t)})),c.appendChild(d),c.appendChild(l),e.appendChild(c),e.appendChild(t);const m=document.createElement("INPUT");m.className="py-2 px-4 bg-green-700 text-white rounded font-semibold text-sm hover:bg-green-800 dark:bg-green-600 dark:hover:bg-green-700",m.type="submit",m.value="Agregar",e.onsubmit=e=>e.preventDefault(),m.onclick=()=>{""!==l.value&&""!==r.value&&"0"!==r.value?(e.reset(),s()):Alerta.Toast.fire({icon:"error",title:"Campos erroneos",text:"Campos vacíos o valor no agregado"})},Modal.renderModal(e,m)},s=()=>{n.find((e=>e.id===o.id))?Alerta.Toast.fire({icon:"error",title:"El costo ya existe",text:"No se puede agregar el mismo costo"}):(o.cantidad_iva="1"===o.iva?.16*+o.cantidad:0,n=[...n,o],saveLocalStorage("costosAdicionales",n),Alerta.Toast.fire({icon:"success",title:"Agregado",text:"El costo ha sido agregado"}),d())},d=()=>{limpiarHTML(t),n.forEach((e=>{const a=document.createElement("LI");a.className="flex flex-row gap-2 items-center font-bold uppercase text-sm dark:text-white",a.innerHTML=`Cuenta: <span class="font-normal"> ${e.cuenta}</span> Monto:<span class="text-sm text-gray-700 dark:text-gray-200">$ ${formatNum(+e.cantidad+ +e.cantidad_iva)} MN</span>`,t.appendChild(a)}));const e=n.reduce(((e,t)=>e+(+t.cantidad+ +t.cantidad_iva)),0),a=document.createElement("LI");a.className="flex flex-row gap-2 items-center text-center text-xl font-bold uppercase text-sm dark:text-white",a.innerHTML=`Total: <span class="font-normal"> $ ${formatNum(e)} MN</span>`,t.appendChild(a)}})();