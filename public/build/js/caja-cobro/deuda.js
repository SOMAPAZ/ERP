import Alerta from"../classes/Alerta.js";import{deleteLocalStorage,formatDateText,formatNum,getLocalStorage,limpiarHTML,saveLocalStorage}from"../helpers/index.js";import GetDatos from"../classes/GetData.js";(()=>{const e=document.querySelector("#formulario-busqueda"),t=document.querySelector("#error"),a=document.querySelector("#busqueda"),n=document.querySelector("#datos-usuario"),s=document.querySelector("#deuda-usuario"),o=document.querySelector("#boton");let r,d="",l=[],c=[];document.addEventListener("DOMContentLoaded",(function(){r=getLocalStorage("idUsuario"),null!==r&&p(r),e.addEventListener("submit",i)}));const i=e=>{limpiarHTML(document.querySelector("#listado-coincidencias ul")),e.preventDefault(),d=a.value.trim(),""!==d?(r=null,deleteLocalStorage("idUsuario"),m()):new Alerta({msg:"Debe ingresar un ID, Nombre o Dirección Válido",position:t})},p=async e=>{const t=`${location.origin}/api/usuario?id=${e}`,a=`${location.origin}/deuda-usuario?id=${e}`;[l,c]=await Promise.all([GetDatos.consultar(t),GetDatos.consultar(a)]),u(),g()},m=()=>{let t;const a=d.indexOf(" - ");if(-1===a){if(isNaN(parseInt(d)))return void Alerta.Toast.fire({icon:"error",title:`'${d}' no es un ID válido`});t=parseInt(d)}else t=parseInt(d.substring(0,a));saveLocalStorage("idUsuario",t),p(t),e.reset()},u=()=>{if("Error"===l.tipo)return void Alerta.Toast.fire({icon:"warning",title:l.msg});limpiarHTML(n);const e=document.createElement("DIV");e.className="rounded-lg border dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm w-full mx-auto px-4 md:px-10";const t=document.createElement("DIV");t.className="space-y-1.5 p-4 flex flex-row items-center gap-4";const a=document.createElement("SPAN");a.className="relative flex shrink-0 overflow-hidden rounded-full w-16 h-16",a.innerHTML=`<img class="aspect-square h-full w-full" alt=${l.user} src="https://api.dicebear.com/6.x/initials/svg?seed=${l.user}">`,t.appendChild(a);const s=document.createElement("DIV");s.className="space-y-1.5 p-6 flex flex-row items-center gap-4",s.innerHTML=`\n    <div>\n      <div class="text-2xl font-semibold leading-none tracking-tight uppercase">\n        ${l.user} ${l.lastname}\n      </div>\n      <p class="text-sm"><span class="font-bold">ID:</span> ${l.id}</p>\n    </div>`,t.appendChild(s);const o=document.createElement("DIV");o.className="p-6 pt-0 grid gap-4";const r=document.createElement("DIV");r.className="grid sm:grid-cols-1 md:grid-cols-2 gap-2";const d=document.createElement("DIV");d.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Dirección: </span><span class="text-sm font-medium">${l.direccion||"Sin Dirección registrada"}</span>`;const c=document.createElement("DIV");c.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Correo: </span><span class="text-sm font-medium">${l.correo||"Sin Correo registrado"}</span>`;const i=document.createElement("DIV");i.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">RFC: </span><span class="text-sm font-medium">${l.rfc||"Sin RFC registrado"}</span>`;const p=document.createElement("DIV");p.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Colonia: </span><span class="text-sm font-medium">${l.id_colony||"Sin Colonia Registrada"}</span>`;const m=document.createElement("DIV");m.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Estado: </span><span class="text-sm font-medium">${l.id_servicestatus}</span>`;const u=document.createElement("DIV");u.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Tipo Servicio: </span><span class="text-sm font-medium">${l.id_servicetype}</span>`;const g=document.createElement("DIV");g.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Tipo Usuario: </span><span class="text-sm font-medium">${l.id_usertype}</span>`;const f=document.createElement("DIV");f.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Tipo toma: </span><span class="text-sm font-medium">${l.id_intaketype} - ${l.id_consumtype}</span>`;const x=document.createElement("DIV");x.innerHTML=`<span class="text-sm font-bold dark:text-gray-400">Otro: </span><span class="text-sm font-medium">${parseInt(l.drain)?"Con Drenaje":"Sin Drenaje"}</span>`,r.appendChild(d),r.appendChild(c),r.appendChild(i),r.appendChild(p),r.appendChild(m),r.appendChild(u),r.appendChild(g),r.appendChild(f),r.appendChild(x),o.appendChild(r),e.appendChild(t),e.appendChild(o),n.appendChild(e)},g=()=>{if(limpiarHTML(s),limpiarHTML(o),"Error"===c.tipo)return void Alerta.Toast.fire({icon:"warning",title:c.msg});if("debe"===c.estado){const e=document.createElement("DIV");e.className="rounded-lg border dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow w-full mx-auto px-4 md:px-10 py-6";const t=document.createElement("DIV");t.className="flex flex-col md:flex-row justify-center items-center gap-8 font-bold uppercase text-center";const a=document.createElement("P");a.className="mb-3 font-bold uppercase text-lg",a.textContent="Periodo de adeudo:";const n=document.createElement("P");n.innerHTML=`Inicio: <span class="font-normal">${formatDateText(c.periodo.inicio)}</span>`;const o=document.createElement("P");o.innerHTML=`Fin: <span class="font-normal">${formatDateText(c.periodo.final)}</span>`,e.appendChild(a),t.appendChild(n),t.appendChild(o),e.appendChild(t),s.appendChild(e)}const e=document.createElement("DIV");if(e.className="rounded-lg border dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow w-full mx-auto px-4 md:px-10 py-6 mt-6","pagado"===c.estado){const t=document.createElement("P");return t.className="text-center font-black uppercase text-lg",t.textContent=c.msg,e.appendChild(t),void s.appendChild(e)}const t=document.createElement("P");t.className="mb-3 font-bold uppercase text-lg",t.textContent="Información del adeudo";const a=document.createElement("UL");a.className="grid grid-cols-1 sm:grid-cols-2";const n=document.createElement("LI");n.innerHTML=`<span class="font-bold">Agua</span>: $ ${formatNum(c.agua)}`;const r=document.createElement("LI");r.innerHTML=`<span class="font-bold">Drenaje:</span> $ ${formatNum(c.drenaje)}`;const d=document.createElement("LI");d.innerHTML=`\n    <div>\n      <span class="font-bold">Recargos:</span> $ ${formatNum(c.recargos.total)}\n      <p class="font-bold text-gray-600 dark:text-gray-400 ms-6">- Agua: <span class="font-normal">\n        $  ${formatNum(c.recargos.agua)}\n      </span></p>\n      <p class="font-bold text-gray-600 dark:text-gray-400 ms-6">- Drenaje: <span class="font-normal">\n        $  ${formatNum(c.recargos.drenaje)}\n      </span></p>\n    </div>\n    `;const i=document.createElement("LI");i.innerHTML=`\n    <div>\n    <span class="font-bold">IVA:</span> $ ${formatNum(c.iva.total)}\n    <p class="font-bold text-gray-600 dark:text-gray-400 ms-6">- Agua: <span class="font-normal">\n    $ ${formatNum(c.iva.agua)}\n    </span></p>\n    <p class="font-bold text-gray-600 dark:text-gray-400 ms-6">- Drenaje: <span class="font-normal">\n    $ ${formatNum(c.iva.drenaje)}\n    </span></p>\n    </div>\n    `;const p=document.createElement("LI");p.innerHTML=`\n    <div>\n      <span class="font-bold">Meses totales:</span> ${c.meses.totales}\n        <p class="font-bold text-gray-600 dark:text-gray-400 ms-6">- Rezagados: <span class="font-normal">${c.meses.rezagados}</span></p>\n      <p class="font-bold text-gray-600 dark:text-gray-400 ms-6">- Naturales: <span class="font-normal">${c.meses.naturales}</span></p>\n    </div>\n    `;const m=document.createElement("LI");m.className="text-2xl text-gray-900 underline dark:text-yellow-200",m.innerHTML=`<span class="font-black">Total:</span> $ ${formatNum(c.total)}`,a.appendChild(n),a.appendChild(r),a.appendChild(d),a.appendChild(i),a.appendChild(p),a.appendChild(m),e.appendChild(t),e.appendChild(a),s.appendChild(e);const u=document.createElement("A");u.className="py-2 px-4 bg-gray-100 dark:bg-gray-700 rounded text-sm text-gray-800 dark:text-white my-4 hover:bg-gray-200 dark:hover:bg-gray-600 font-semibold flex flex-row gap-2 items-center uppercase",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z" /></svg><p class="font-bold text-xs">Realizar pago</p>',u.href=`/pagar-total?usuario=${l.id}`;const g=document.createElement("A");g.className="text-gray-900 dark:text-white flex items-center justify-center sm:w-full md:w-auto uppercase text-xs py-2 px-6 rounded-sm gap-2",g.innerHTML='<svg class="h-6 w-6 text-gray-900 dark:text-white"  width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">  <path stroke="none" d="M0 0h24v24H0z"/>  <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />  <circle cx="12" cy="12" r="3" /></svg><p class="font-bold text-xs">Configurar</p>',g.href=`/consultar-avanzados?usuario=${l.id}`,o.appendChild(u),o.appendChild(g)}})();