(()=>{let e=[];const t=document.getElementById("formulario-notificaciones"),o=document.getElementById("idUser"),n=document.getElementById("evidencia"),i=document.getElementById("tipoNotificacionInput"),a=document.getElementById("evidencia"),c=document.getElementById("comentarios");async function r(e){e.preventDefault();const r=o.value.trim(),d=n.value.trim(),l=i.value.trim(),s=a.files[0],m=c.value.trim(),u=localStorage.getItem("notificacion"),f=u?JSON.parse(u).idx:null;if(!l)return void function(e){const o=document.createElement("DIV");o.className="rounded border-s-4 mt-6 border-red-500 bg-red-50 p-4 dark:border-red-600 dark:bg-red-900 alerta",o.innerHTML=`<strong class="block font-medium text-red-700 dark:text-red-200">${e}</strong>`,document.querySelector(".alerta")?.remove(),t.parentElement.insertBefore(o,t),setTimeout((()=>{o.remove()}),5e3)}("Debe seleccionar un Tipo de Notificación.");const g={idUser:r,evidencia:d,idTiponotificacion:l,comentarios:m,idx:f},p=new FormData;p.append("id_user",r),p.append("evidencia",d),p.append("id_tiponotificacion",l),p.append("comentarios",m),f&&p.append("idx",f),s&&p.append("imagen",s);if((await Swal.fire({title:"¿Confirmar envío?",text:"El costo de la notificación se cargará en caja.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, enviar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e=`${location.origin}/notificaciones/agenda`,t=`${location.origin}/notificaciones/registro-extra`,o=await fetch(e,{method:"POST",body:p}),n=await o.json();"Exito"===n.tipo&&(localStorage.setItem("notificacion",JSON.stringify(g)),await fetch(t,{method:"POST",body:p}),Swal.fire({title:n.tipo,text:n.mensaje,icon:"success",confirmButtonText:"OK"}).then((()=>{window.location.href="/agenda",localStorage.removeItem("notificacion")})))}catch(e){console.log(e)}}document.addEventListener("DOMContentLoaded",(()=>{!async function(){try{const t=`${location.origin}/api/tiposNotificacion`,o=await fetch(t);e=await o.json(),i.innerHTML="",e.forEach((e=>{if("1"!==e.id){const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.name,i.appendChild(t)}}))}catch(e){console.error("Error al obtener el tipo de notificacion:",e)}}(),function(){const e=localStorage.getItem("notificacion");if(e){const t=JSON.parse(e);document.getElementById("idUser").value=t.id_user,document.getElementById("nombreCompleto").value=t.user,document.getElementById("direccion").value=t.address,document.getElementById("colonia").value=t.id_colony,document.getElementById("zona").value=t.id_zone,document.getElementById("observaciones").value=t.id_observaciones}}(),document.querySelectorAll(".tipo_notificacion").forEach((e=>{e.addEventListener("click",(function(){document.querySelectorAll(".tipo_notificacion").forEach((e=>{e.classList.remove("bg-blue-800","text-white","dark:bg-blue-500","dark:text-white"),e.classList.add("text-blue-700","dark:text-white")})),this.classList.remove("text-blue-700","dark:text-blue-500"),document.getElementById("tipoNotificacionInput").value=this.getAttribute("data-id")}))})),t.addEventListener("submit",r)}))})();